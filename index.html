<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Laroche Glaucoma Risk Calculator</title>
  <meta name="description" content="Method for estimating risk of having or developing glaucoma based on Age, IOP, and CCT." />
  <style>
    :root { --bg:#0b1020; --card:#121a34; --ink:#e9ecf5; --muted:#a9b1c7; --accent:#5ea1ff; --danger:#ff7373; --ok:#73d17b; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif; color:var(--ink); background:linear-gradient(180deg,#0a0f21,#111a39 40%,#0a0f21); }
    header { padding:28px 16px 8px; text-align:center; }
    header h1 { margin:0; font-size:clamp(22px,3vw,32px); letter-spacing:.2px; }
    header p { margin:.6rem auto 0; color:var(--muted); max-width:1000px; }
    /* (1) smaller intro font */
    .intro { font-size: clamp(13px, 1.6vw, 15px); line-height: 1.45; }
    /* (2) red disclaimer sentence */
    .disclaimer-strong { color: var(--danger); font-weight: 700; }
    .wrap { max-width:1100px; margin:16px auto 48px; padding:0 16px; }
    /* (4) stack everything: single-column always */
    .grid { display:grid; gap:16px; grid-template-columns:1fr; }
    .card { background:color-mix(in oklab,var(--card) 92%,black); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.3); }
    .card h2 { margin:.2rem 0 1rem; font-size:20px; }
    fieldset { border:0; margin:0 0 14px; padding:0; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:10px 0; }
    @media (max-width: 640px){ .row { grid-template-columns: 1fr; } }
    label { font-size:14px; color:var(--muted); display:block; margin-bottom:6px; }
    select, input[type="number"], input[type="text"], textarea {
      width:100%; padding:12px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.03); color:var(--ink); outline:none;
    }
    textarea { min-height:72px; resize:vertical; }
    .result { margin-top:10px; padding:12px; border-radius:12px; background:rgba(255,255,255,.03); border:1px dashed rgba(255,255,255,.15); }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; letter-spacing:.2px; border:1px solid rgba(255,255,255,.18); margin-left:8px; }
    .pill.ok { background:rgba(115,209,123,.12); border-color:rgba(115,209,123,.4); color:var(--ok); }
    .pill.bad { background:rgba(255,115,115,.12); border-color:rgba(255,115,115,.4); color:var(--danger); }
    .actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; }
    button { appearance:none; border:1px solid rgba(255,255,255,.15); background:linear-gradient(180deg,#1a2a57,#17234c); color:#fff; padding:12px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
    button.secondary { background:transparent; }
    small.caption { color:var(--muted); display:block; margin-top:6px; }
    footer { color:var(--muted); text-align:center; font-size:13px; margin:36px 0 20px; }
    a { color:var(--accent); text-decoration:none; }
    .mono { font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; }

    /* table styles */
    table { width:100%; border-collapse:collapse; }
    thead th { text-align:center; font-weight:700; padding:8px; border-bottom:1px solid rgba(255,255,255,.18); }
    tbody td, tbody th { border-bottom:1px solid rgba(255,255,255,.08); padding:8px; text-align:center; }
    tbody th { text-align:left; color:var(--muted); font-weight:600; }
    .hrisk, .lrisk { margin-top:10px; padding:12px; border-radius:12px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.12); }
  </style>
</head>
<body>
  <header>
    <h1>Laroche Glaucoma Risk Calculator</h1>

    <!-- smaller intro -->
    <p class="intro">
      Based on results from the Ocular Hypertension Treatment Study (OHTS) and the European Glaucoma Prevention Study (EGPS), we present a method for
      estimating if you are at higher risk or lower risk for having or developing glaucoma. The method may be useful to clinicians and patients in
      deciding the frequency of examinations, tests, and the potential benefit of starting treatment and/or having earlier cataract surgery and
      microinvasive glaucoma surgery.
    </p>

    <!-- red disclaimer + reworded closing -->
    <p style="margin-top:.6rem">
      <span class="disclaimer-strong">The risks derived using these methods are designed to aid but not to replace clinical judgment and a complete ophthalmic examination.</span>
      <br/>
      For additional inquiries regarding this calculator, please contact Dr. Daniel Laroche using the contact information provided at the bottom of this page.
      Copyright 2023, Daniel Laroche MD, Advanced Eyecare of New York.
    </p>
  </header>

  <div class="wrap">
    <div class="grid">
      <!-- CALCULATOR FIRST (stacked layout) -->
      <section class="card">
        <h2>Calculate Glaucoma Risk</h2>

        <div class="result" id="directions">
          <strong>Directions</strong>
          <p>
            This calculator requires only three factors to estimate glaucoma risk: Age, Intraocular pressure (IOP), and Central corneal thickness (CCT).
            Enter the site, age, IOP, and CCT in the boxes below for each eye. Select <em>Calculate risk</em> to determine patient risk and select
            <em>Save to log</em>.
          </p>
        </div>

        <fieldset class="row">
          <div>
            <label for="siteSel">Site</label>
            <select id="siteSel">
              <option value="">Select site…</option>
              <option>Advanced Eye Care of New York (Queens)</option>
              <option>Advanced Eye Care of New York (Manhattan)</option>
              <option>Howard University</option>
              <option>Other</option>
            </select>
          </div>
          <div id="siteOtherWrap" style="display:none">
            <label for="siteOther">If other, please specify</label>
            <input id="siteOther" type="text" placeholder="Enter site name" />
          </div>
        </fieldset>

        <fieldset class="row">
          <div>
            <label for="age">Age (years)</label>
            <input id="age" type="number" min="1" max="120" step="1" placeholder="e.g., 62" />
          </div>
          <div></div>
        </fieldset>

        <fieldset>
          <div class="row">
            <div>
              <label for="iopr">IOP Right (mmHg)</label>
              <input id="iopr" type="number" min="1" max="80" step="1" placeholder="e.g., 24" />
            </div>
            <div>
              <label for="iopl">IOP Left (mmHg)</label>
              <input id="iopl" type="number" min="1" max="80" step="1" placeholder="e.g., 22" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="cctr">CCT Right (μm)</label>
              <input id="cctr" type="number" min="350" max="700" step="1" placeholder="e.g., 520" />
            </div>
            <div>
              <label for="cctl">CCT Left (μm)</label>
              <input id="cctl" type="number" min="350" max="700" step="1" placeholder="e.g., 505" />
            </div>
          </div>
        </fieldset>

        <fieldset>
          <label for="dx">Additional diagnoses</label>
          <textarea id="dx" placeholder="e.g., closed angle glaucoma"></textarea>
        </fieldset>

        <div class="actions">
          <button id="calcBtn">Calculate risk</button>
          <button class="secondary" id="clearBtn" type="button">Clear</button>
          <button class="secondary" id="saveBtn" type="button" title="Stores a row to your Google Sheet">Save to log</button>
        </div>

        <div id="outR" class="result" hidden></div>
        <div id="outL" class="result" hidden></div>
        <div id="riskInfo" class="result" hidden></div>

        <small class="caption">
          Risk guidance: Sum of points <strong>0–5 → Low risk (re-evaluate in 1 year)</strong>; <strong>6–18 → High risk (complete ophthalmic evaluation ASAP)</strong>.
        </small>
      </section>

      <!-- SCORING TABLE SECOND (stacked layout) -->
      <section class="card">
        <h2>Scoring table</h2>
        <div class="result" style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>Risk factor</th>
                <th>−3</th><th>−2</th><th>−1</th><th>0</th>
                <th>+1</th><th>+2</th><th>+3</th><th>+4</th><th>+5</th><th>+6</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>Age (years)</th>
                <td>—</td><td>—</td><td>—</td><td>≤40</td>
                <td>41–50</td><td>51–60</td><td>61–70</td><td>71–80</td><td>81–90</td><td>≥91</td>
              </tr>
              <tr>
                <th>Mean IOP (mmHg)</th>
                <td>—</td><td>—</td><td>—</td><td>≤12</td>
                <td>13–15</td><td>16–18</td><td>19–21</td><td>22–25</td><td>26–29</td><td>≥30</td>
              </tr>
              <tr>
                <th>Mean CCT (μm)</th>
                <td>&gt;600</td><td>576–600</td><td>551–575</td><td>526–550</td>
                <td>500–525</td><td>475–499</td><td>450–474</td><td>425–449</td><td>400–424</td><td>&lt;400</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="caption">
          More information is available in this manuscript from the <em>Journal of Ophthalmology</em>:
          “A Novel, Low-Cost Glaucoma Calculator to Identify Glaucoma Patients and Stratify Management”
          by D. Laroche, K. Rickford, E. V. Mike, L. Hunter, E. Ede, C. Ng, and J. Douglas
          (doi: 10.1155/2022/5288726. PMID: 35957745; PMCID: PMC9357680).
        </p>
      </section>

      <!-- Limitations and Cautions remains as-is -->
      <section class="card">
        <h2>Limitations and Cautions</h2>
        <ul>
          <li>The prediction methods presented here are derived from the Laroche Glaucoma calculator study. There is no guarantee that the predicted risk is accurate for individual patients.</li>
          <li>The predictions are more likely to be accurate for patients who are similar to the participants studied in the study. This calculator should exclude congenital and juvenile glaucoma in younger patients.</li>
          <li>These prediction models were derived from studies of patients with and without glaucoma. It is not clear whether these models also predict progression of established disease or the development of visual disability from the need for glasses, retinopathy, cataracts and other diseases.</li>
          <li>This calculator does not require optic nerve evaluation, vertical cup to disc ratio, nor visual field evaluation. These evaluations should be performed as soon as possible on high-risk patients as part of a complete ophthalmic examination. On low-risk patients, a complete ophthalmic examination should be performed within 6–12 months.</li>
          <li><strong>The risks derived using these methods are designed to aid but not to replace clinical judgment and a complete ophthalmic examination.</strong></li>
        </ul>
        <p class="caption">
          Copyright: Daniel Laroche MD, Advanced Eyecare of New York. Direct users may choose to use the estimators online or download the estimators
          to their own electronic devices for future personal use. Estimators may not be otherwise downloaded or redistributed without permission from
          Daniel Laroche MD. &nbsp; Contact: <a href="mailto:info@advancedeyecareny.com">info@advancedeyecareny.com</a>
          &nbsp;|&nbsp; Advanced Eyecare of New York, 49 West 127<sup>th</sup> Street, New York, NY 10027 &nbsp;|&nbsp; 212-663-0473 &nbsp;|&nbsp; 718-217-0424
        </p>
      </section>
    </div>
  </div>

  <footer>
    <div>© 2023 Daniel Laroche MD, Advanced Eyecare of New York.</div>
  </footer>

  <script>
    // Endpoint remains configured (UI box removed as requested)
    const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbw1aZVaPSjHe-4A4dVbWpmOrJ1fPDCyCrcOvdbeY-tZ9NX432vSypbMqy2EXHEK77x3/exec";

    // Site "Other" toggle
    const siteSel = document.getElementById("siteSel");
    const siteOtherWrap = document.getElementById("siteOtherWrap");
    const siteOther = document.getElementById("siteOther");
    siteSel.addEventListener("change", () => {
      siteOtherWrap.style.display = siteSel.value === "Other" ? "block" : "none";
      if (siteSel.value !== "Other") siteOther.value = "";
    });

    // Scoring helpers
    function agePoints(age){
      if (age <= 40) return 0;
      if (age <= 50) return 1;
      if (age <= 60) return 2;
      if (age <= 70) return 3;
      if (age <= 80) return 4;
      if (age <= 90) return 5;
      return 6;
    }
    function iopPoints(iop){
      if (iop <= 12) return 0;
      if (iop <= 15) return 1;
      if (iop <= 18) return 2;
      if (iop <= 21) return 3;
      if (iop <= 25) return 4;
      if (iop <= 29) return 5;
      return 6;
    }
    function cctPoints(cct){
      if (cct > 600) return -3;
      if (cct >= 576) return -2;
      if (cct >= 551) return -1;
      if (cct >= 526) return 0;
      if (cct >= 500) return 1;
      if (cct >= 475) return 2;
      if (cct >= 450) return 3;
      if (cct >= 425) return 4;
      if (cct >= 400) return 5;
      return 6;
    }
    function classify(sum){ return sum <= 5 ? {tag:"Low risk (re-evaluate in 1 year)", cls:"ok"} : {tag:"High risk (complete ophthalmic evaluation ASAP)", cls:"bad"}; }

    const el = (id) => document.getElementById(id);
    const age = el("age"), iopr = el("iopr"), iopl = el("iopl"), cctr = el("cctr"), cctl = el("cctl"), dx = el("dx");
    const outR = el("outR"), outL = el("outL"), riskInfo = el("riskInfo");

    const TEXT_HIGH = `
      <div class="hrisk">
        <strong>Information for <span style="color:#ff9f9f">High Risk</span> Patients</strong>
        <p>Based on checking your age, intraocular pressures and central corneal thickness your risk for glaucoma is high.
        We recommend a complete examination as soon as possible to check your optic nerve and visual field to make sure you do not currently have glaucoma.
        You should also get checked for glasses, cataracts, retinopathy, and macular degeneration.
        Your risk for these conditions increases with age and you should be checked every year.</p>
      </div>`;
    const TEXT_LOW = `
      <div class="lrisk">
        <strong>Information for <span style="color:#9fe3a1">Low Risk</span> Patients</strong>
        <p>Based on checking your age, intraocular pressures and central corneal thickness your risk for glaucoma is low.
        We recommend a complete examination once a year to fully check for glasses, cataracts, glaucoma, retinopathy, and macular degeneration.
        Your risk for these conditions increases with age and should be checked every year.</p>
      </div>`;

    window.calc = function calc(){
      const a = Number(age.value || 0);
      const rIOP = Number(iopr.value || 0);
      const lIOP = Number(iopl.value || 0);
      const rCCT = Number(cctr.value || 0);
      const lCCT = Number(cctl.value || 0);

      const ap = agePoints(a);
      const r = ap + iopPoints(rIOP) + cctPoints(rCCT);
      const l = ap + iopPoints(lIOP) + cctPoints(lCCT);
      const rc = classify(r), lc = classify(l);

      outR.hidden = false; outL.hidden = false;
      outR.innerHTML = `<strong>Right eye total:</strong> <span class="pill ${rc.cls}">${r} pts</span><br/>
        <strong>Risk:</strong> <span class="pill ${rc.cls}">${rc.tag}</span>`;
      outL.innerHTML = `<strong>Left eye total:</strong> <span class="pill ${lc.cls}">${l} pts</span><br/>
        <strong>Risk:</strong> <span class="pill ${lc.cls}">${lc.tag}</span>`;

      const anyHigh = (rc.cls === "bad") || (lc.cls === "bad");
      riskInfo.hidden = false;
      riskInfo.innerHTML = anyHigh ? TEXT_HIGH : TEXT_LOW;

      return {
        site: siteSel.value === "Other" ? (siteOther.value || "Other") : siteSel.value,
        a, rIOP, lIOP, rCCT, lCCT,
        ap, r, l, rcTag: rc.tag, lcTag: lc.tag,
        diagnoses: dx.value
      };
    }

    el("calcBtn").addEventListener("click", () => window.calc());
    el("clearBtn").addEventListener("click", () => {
      [siteSel, siteOther].forEach(x => x.value = "");
      siteOtherWrap.style.display = "none";
      [age,iopr,iopl,cctr,cctl,dx].forEach(x => x.value = "");
      outR.hidden = true; outL.hidden = true; riskInfo.hidden = true; riskInfo.innerHTML = "";
    });

    el("saveBtn").addEventListener("click", async () => {
      const ENDPOINT = "https://script.google.com/macros/s/AKfycbw1aZVaPSjHe-4A4dVbWpmOrJ1fPDCyCrcOvdbeY-tZ9NX432vSypbMqy2EXHEK77x3/exec";
      const payload = window.calc();
      try {
        const res = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ source: "laroche-glaucoma-calculator", data: payload, ua: navigator.userAgent })
        });
        if (!res.ok) throw new Error("HTTP " + res.status);
        alert("Saved ✔︎");
      } catch (e) {
        alert("Save failed. Check endpoint and permissions.\n" + e.message);
      }
    });
  </script>
</body>
</html>
